<!DOCTYPE html>
<html  ng-app>
    <head>
        <title>Add Defect</title>
        <script src="js/angular.js"></script>
        <script>
            function viewDefectController($scope)
            {
                $scope.addNew = function ()
                {
                    $scope.defects.push($scope.defect);
                    localStorage.setItem("defects", JSON.stringify($scope.defects));
                    $scope.createNewDefect();
                }

                $scope.maxID = 0;

                $scope.createNewDefect = function ()
                {
                    $scope.maxID = ++$scope.maxID;
                    $scope.clearDefect();
                }

                $scope.init = function () 
                {
                    var data = JSON.parse(localStorage.getItem("defects"));
                    if (data == null)
                    {
                        $scope.defects = [];
                    }
                    else
                    {
                        $scope.defects = data;
                    }
                    angular.forEach($scope.defects, function (defect)
                    {
                        if (defect.ID != undefined)
                        {
                            if (defect.ID > $scope.maxID)
                            {
                                $scope.maxID = defect.ID;
                            }
                        }
                    });
                    $scope.createNewDefect();
                }
                $scope.newDefect;
                $scope.clearDefect = function ()
                {
                    $scope.defect =
                       {
                            'ID': $scope.maxID,
                            'Title': '',
                            'Description': '',
                            'Project': '',
                            'Severity': 0,
                            'Status': 0,
                            'Engineer': '',
                            'Tester': '',
                            'ResolvedVersion': '',
                            'DiscoveredVersion': '',
                            'ReportedDate': '',
                            'Priority': '',
                            'ResolutionDescription': '',
                            'FixedTime': 1,
                            'DateChanged': '',
                            'TestDate': '',
                            'ReleaseDate': '',
                            'Visibility': 'true',
                            'Comments': [{ 'User': '', 'Comment': '' }]
                        }
                }

                $scope.defects = [];
                //=
                //    [{
                //        'ID': 0,
                //        'Title': 'title',
                //        'Description': 'Description',
                //        'Project': 'Project',
                //        'Severity': 1,
                //        'Status': 1,
                //        'Engineer': 'engineer',
                //        'Tester': 'Tester',
                //        'ResolvedVersion': 'Version',
                //        'DiscoveredVersion': 'Version',
                //        'ReportedDate': 'Date',
                //        'Priority': 'priority',
                //        'ResolutionDescription': 'desc',
                //        'FixedTime': 1,
                //        'DateChanged': 'date',
                //        'TestDate': 'Date',
                //        'ReleaseDate': 'Date',
                //        'Visibility': 'true',
                //        'Comments': [{ 'User': 'name', 'Comment': 'Comment' },
                //                    { 'User': 'name', 'Comment': 'Comment'}]
                //    }]
            }

        </script>

        <style>
            #addDefect
            {
                width:330px;
            }
            #addDefect br + label
            {
                float:left;
            }
            
            #addDefect label + label, #addDefect textarea, #addDefect input
            {
                float:right;
            }
            
            #addDefect br
            {
                clear:both;
            }
            
            #addDefect h1
            {
                text-align:center;
            }
        </style>
    </head>
    <body ng-controller="viewDefectController" ng-init="init()">
        
        <div id="addDefect">
            <div >
                <h1>Add New Defect</h1>
                <br />
                <label>ID</label>
                <label> {{defect.ID}}</label>
                <br />
                <label>Title:</label>
                <input type="text" value={{defect.Title}} />
                <br />
                <label>Description</label>
                <textarea rows="5" cols="20">{{defect.Description}}</textarea>
                <br />
                <label>Project</label>
                <input type="text" value={{defect.Project}} />
                <br />
                <label>Severity</label>
                <input type="text" value={{defect.Severity}} />
                <br />
                <label>Tester</label>
                <input type="text" value={{defect.Tester}} />
                <br />
                <label>Resolved Version</label>
                <input type="text" value={{defect.ResolvedVersion}} />
                <br />
                <label>Discovered Version</label>
                <input type="text" value={{defect.DiscoveredVersion}} />
                <br />
                <label>Reported Date</label>
                <label>{{defect.ReportedDate}}</label>
                <br />
                <label>Priority</label>
                <input type="number" value={{defect.Priority}} />
                <br />
                <label>Resolution Description</label>
                <textarea rows="5" cols="20">{{defect.ResolutionDescription}}</textarea>
                <br />
                <label>Fixed Time</label>
                <input type="number" value={{defect.FixedTime}} />
                <br />
                <label>Date Changed</label>
                <label>{{defect.DateChanged}}</label>
                <br />
                <label>Test Date</label>
                <label>{{defect.TestDate}}</label>
                <br />
                <label>Release Date</label>
                <label>{{defect.ReleaseDate}}</label>
                <br />
                <label>Visibility</label>
                <input type="checkbox" value={{defect.visibility}} />
                <br />
            
                <input type="button" value="Add Defect" ng-click="addNew()" />
            </div>
        </div>
    </body>
</html>
